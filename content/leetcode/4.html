---
title: "4. Median of Two Sorted Arrays"
date: 2021-02-22
draft: false
---


<h3>Solution</h3>

<p>
  We start by noticing that calculating the median of an array really amounts to partitioning the array into two partitions such that every element in the left partition is less than or equal to every element in the right partition. If the array has even length then both partitions will have an equal number of elements. If the array has odd length then the left partition will have one more element than the right.
</p>

<pre>x1 x2 x3 | x4 x5 x6       median = (x3 + x4) / 2

x1 x2 x3 x4 | x5 x6 x7    median = x4</pre>

<p>
  To calculate the median in the even case, we are interested in the average of the largest element of the left partition and the smallest element of the right partition. In the odd case, we are interested in the largest element in the left partition.
</p>

<p>
  Now let us consider the following case:
</p>

<pre>nums1 = x1 x2 x3 x4 x5 x6
nums2 = y1 y2 y3 y4 y5 y6 y7 y8</pre>

<p>
  If we partition nums1 as x1 x2 | x3 x4 x5 x6 then we have to partition nums2 as y1 y2 y3 y4 y5 | y6 y7 y8 to ensure both halves of the partition of the merged array have 7 elements.
</p>

<p>
  Further, if x2 ≤ y6 and y5 ≤ x3 then we are guaranteed that every element on the left side is less than or equal to every element in the right half in the partition x1 x2 y1 y2 y3 y4 y5 | x3 x4 x5 x6 y6 y7 y8 of the merged array.
</p>

<p>
  The largest element in the left partition of the merged array is max(x2, y5) and smallest element in the right partition is min(x3, y6). But then our median must be the average of max(x2, y5) and min(x3, y6). If the merged array had an odd number of elements the median would be max(x2, y5).
</p>

<p>
  To find the partition, we perform a binary search on the smaller array and try to find a point that a) ensures both halves have the same number of elements and b) meets a similar condition as x2 ≤ y6 and y5 ≤ x3 in the example case.
</p>



{{% code java %}}class Solution {
  
  public double findMedianSortedArrays(int[] nums1, int[] nums2) {
    int[] shorter = nums1;
    int[] longer = nums2;
    
    if (nums1.length > nums2.length) {
      shorter = nums2;
      longer = nums1;
    }
    
    int lo = 0;
    int hi = shorter.length;
        
    while (lo <= hi) {
      int i = (lo + hi) / 2;
      int j = (shorter.length + longer.length + 1) / 2 - i;
      
      // find x2 and x3 in x1 x2 | x3 x4 x5 x6
      int shorterLeft = i == 0 ? Integer.MIN_VALUE : shorter[i - 1];
      int shorterRight = i == shorter.length ? Integer.MAX_VALUE : shorter[i];
      
      // find y5 and y6 in y1 y2 y3 y4 y5 | y6 y7 y8
      int longerLeft = j == 0 ? Integer.MIN_VALUE : longer[j - 1];
      int longerRight = j == longer.length ? Integer.MAX_VALUE : longer[j];
        
      if (shorterLeft > longerRight) {  // x2 > y6
        hi = i - 1;
      } else if (longerLeft > shorterRight) {  // y5 > x3
        lo = i + 1;
      } else {
        int maxLeft = shorterLeft > longerLeft ? shorterLeft : longerLeft;
        int minRight = shorterRight > longerRight ? longerRight : shorterRight;
        
        if ((shorter.length + longer.length) % 2 == 1) return maxLeft;
        
        return (maxLeft + minRight) / 2.0;
      }
    }
    
    return -1;
  }
}{{% /code %}}


<h3>Resources</h3>

<ul>
  <li>
    <a href="https://leetcode.com/problems/median-of-two-sorted-arrays/">Original Problem</a>
  </li>
  <li>
    <a href="https://www.youtube.com/watch?v=LPFhl65R7ww">Tushar Roy</a>
  </li>
</ul>
