---
title: "Sockets"
date: 2021-02-22
draft: false
---

<ul class="article__contents">
  <li>
    <a href="introduction">Introduction</a>
  </li>
  <li>
    <a href="usage">Usage</a>
  </li>
  <li>
    <a href="resources">Resources</a>
  </li>
</ul>

<!-- 
  {{% inline-code %}}{{% /inline-code %}}
  {{% code c %}}{{% /code %}}
 -->


<h3 id="introduction">Introduction</h3>

<p>
  Sockets allow data to exchanged between applications on the same host or on different hosts connected over the network. Typically, a server creates and binds its socket to an address while clients create sockets and connect to the server socket by means of its address.
</p>



<h3 id="communication-domains">Communication Domains</h3>

<p>
  Sockets exist in a communication domain which determines the method of identifying a socket by means of an address and the range of communication possible. Modern systems support at least the following domains:
</p>

<ul>
  <li>
    {{% inline-code %}}AF_UNIX{{% /inline-code %}}: allows communication between applications on the same host.
  </li>
  <li>
    {{% inline-code %}}AF_INET{{% /inline-code %}}: allows communication between applications on hosts connected via an IPv4 network.
  </li>
  <li>
    {{% inline-code %}}AF_INET6{{% /inline-code %}}: allows communication between applications on hosts connected via an IPv6 network.
  </li>
</ul>


<h3 id="socket-types">Socket Types</h3>

<p>
  Stream sockets (SOCK_STREAM) provide reliable, bidirectional, byte-stream communication between a pair of sockets. Stream sockets operate in connect pairs and are thus described as connection-oriented.
</p>

<p>
  In contrast, datagrams sockets (SOCK_DGRAM) allow data to be exchanged in the form of messages called datagrams. Data transmission is unreliable and a datagram socket is connectionless as it does not need to be connected to another socket in order to be used.
</p>

<p>
  In the Internet domain, datagram sockets employ the User Datagram Protocol (UDP) while stream sockets employ the Transmission Control Protocol (TCP).
</p>



<h3 id="creating-sockets">Creating Sockets</h3>

<p>
  The {{% inline-code %}}socket(){{% /inline-code %}} system call creates a new socket. The communication domain is specified by {{% inline-code %}}domain{{% /inline-code %}} and {{% inline-code %}}protocol{{% /inline-code %}} can usually be specified as 0. The call returns a file descriptor to the created socket or -1 on error.
</p>

{{% code c %}}int socket(int domain, int type, int protocol);{{% /code %}}


<h3 id="network-byte-order">Network Byte Order</h3>

<p>
  Different hardware architectures store the bytes of a multi-byte integer in different orders. Those architectures that store the most significant bit at the lowest memory address are called big endian while those that store the least significant byte first are called little endian. Since port numbers and IP addresses must be transmitted between a variety of hosts the network byte order was defined to be big endian.
</p>

{{% code c %}}#include <arpa/inet.h>

// returns host_uint16 converted to network byte order
uint16_t htons(uint16_t host_uint16);

// returns host_uint32 converted to network byte order
uint32_t htonl(uint32_t host_uint32);

// returns net_uint16 converted to host byte order
uint16_t ntohs(uint16_t net_uint16);

// returns net_uint32 converted to host byte prder
uint32_t ntohl(uint32_t net_uint32);{{% /code %}}


<h3 id="socket-addresses">Socket Addresses</h3>

<p>
  Each communication domain uses a different address format. For instance, UNIX domain sockets use pathnames while Internet domain sockets use an IP address and port number. The generic address structure {{% inline-code %}}struct sockaddr{{% /inline-code %}} is provided for the purpose of being cast to the various domain-specific address structures.
</p>

{{% code c %}}struct sockaddr {
  sa_family_t sa_family;  // address family (AF_ constant)
  char sa_data[14];       // socket address
 };{{% /code %}}

<p>
  A IPv4 socket address is stored in a sockaddr_in 
</p>

{{% code c %}}struct in_addr { /* IPv4 4-byte address */
  in_addr_t s_addr; /* Unsigned 32-bit integer */
 };
 struct sockaddr_in { /* IPv4 socket address */
  sa_family_t sin_family; /* Address family (AF_INET) */
  in_port_t sin_port; /* Port number */
  struct in_addr sin_addr; /* IPv4 address */
  unsigned char __pad[X]; /* Pad to size of 'sockaddr'
  structure (16 bytes) */
 };{{% /code %}}




<h3 id="TODO">TODO</h3>

<p>
  The {{% inline-code %}}getaddrinfo(){{% /inline-code %}} functions converts host and service names to IP addresses and port numbers while the {{% inline-code %}}getnameinfo(){{% /inline-code %}} function translates a socket address structure to strings containing the corresponding host and service name.
</p>


{{% code c %}}#include <sys/socket.h>
#include <netdb.h>

int getaddrinfo(const char *host, const char *service, const struct addrinfo *hints, struct addrinfo **result);{{% /code %}}

<p>
  The {{% inline-code %}}host{{% /inline-code %}} argument contains either a hostname or a numeric address string in IPv6 dotted-decimal notation or IPv6 hex-string notation. The {{% inline-code %}}service{{% /inline-code %}} argument contains either a service name or a decimal port number. The {{% inline-code %}}hints{{% /inline-code %}} argument points to an {{% inline-code %}}addrinfo{{% /inline-code %}} structure that specifies further criteria for selecting the socket address structures returned via {{% inline-code %}}result{{% /inline-code %}}.
</p>

<p>
  As output, {{% inline-code %}}getaddrinfo(){{% /inline-code %}} dynamically allocates a linked list of {{% inline-code %}}addrinfo{{% /inline-code %}} structures and sets {{% inline-code %}}result{{% /inline-code %}} to this list. Each of the {{% inline-code %}}addrinfo{{% /inline-code %}} includes a pointer to a {{% inline-code %}}sockaddr{{% /inline-code %}} structure corresponding to {{% inline-code %}}host{{% /inline-code %}} and {{% inline-code %}}service{{% /inline-code %}}.
</p>


{{% code c %}}struct addrinfo {
  int ai_flags;              /* Input flags (AI_* constants) */
  int ai_family;             /* Address family */
  int ai_socktype;           /* Type: SOCK_STREAM, SOCK_DGRAM */
  int ai_protocol;           /* Socket protocol */
  size_t ai_addrlen;         /* Size of structure pointed to by ai_addr */
  char *ai_canonname;        /* Canonical name of host */
  struct sockaddr *ai_addr;  /* Pointer to socket address structure */
  struct addrinfo *ai_next;  /* Next structure in linked list */
};{{% /code %}}

<p>
  The {{% inline-code %}}ai_flags{{% /inline-code %}} is a bit mask that modifies the behavior of 
</p>





<h3 id="resources">Resources</h3>

<ul>

</ul>
